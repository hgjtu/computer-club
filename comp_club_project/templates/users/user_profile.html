{% extends "base.html" %}
{% load static %}

{% block title %}
  КиберСпот. Профиль.
{% endblock %}

{% block content %}
{% if user.is_authenticated and view_user == user.username %}
<div class="container mt-5">
  <div class="row">
      <div class="col-md-4 text-center">
        <img src="{{ user.img_path.url }}" alt="Фото пользователя" class="img-fluid mb-3 profile-img">
      </div>
      <div class="col-md-8">
        <h2>{{ user.username }}</h2>
        {% if user.first_name %}
            <p><strong>Имя:</strong> {{ user.first_name }}</p>
        {% endif %}
        {% if user.last_name %}
            <p><strong>Фамилия:</strong> {{ user.last_name }}</p>
        {% endif %}
        {% if user.phone_num %}
            <p><strong>Номер телефона:</strong> {{ user.phone_num }}</p>
        {% endif %}
        <p><strong>Email:</strong> {{ user.email }}</p>
        {% if user.date_of_birth %}
            <p><strong>Дата рождения:</strong> {{ user.date_of_birth }}</p>
        {% endif %}
        <a href="{% url 'users:edit' user.username %}" class="btn btn-warning">Изменить профиль</a>
      </div>
  </div>
</div>
<button id="fetchSessionsBtn" class="btn btn-primary">Показать сессии</button>
<div class="container mt-4">
  <h2>Ваши сессии</h2>
  <table class="table" id="sessionsTable">
    <thead>
      <tr>
        <th scope="col">Номер сессии</th>
        <th scope="col">Время начала сессии</th>
        <th scope="col">Время окончания сессии</th>
        <th scope="col">Тип услуги</th>
        <th scope="col">Оборудование</th>
      </tr>
    </thead>
  <tbody>
    {% for session in page_obj %}
    <tr>

    </tr>
  {% endfor %}
  </tbody>
  </table>
  {% include "includes/paginator.html" %}
</div>
<script>
  document.getElementById('fetchSessionsBtn').addEventListener('click', function() {
  fetch('/api/sessions/')
        .then(response => response.text()) // Получаем ответ как текст
        .then(text => {
            print(text);
  )});
  document.getElementById('fetchSessionsBtn').addEventListener('click', function() {
    fetch('fetch_sessions')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.querySelector('#sessionsTable tbody');
            tableBody.innerHTML = ''; // очищаем содержимое таблицы

            data.forEach(session => {
                // Создаем новую строку таблицы
                const row = 
                    <tr>
                        <td>${session.id}</td>
                        <td>${new Date(session.start_time).toLocaleString()}</td>
                        <td>${session.end_time ? new Date(session.end_time).toLocaleString() : 'Не завершена'}</td>
                        <td>${session.service_id}</td>
                        <td>${session.equipment_id}</td>
                    </tr>
                ;
                tableBody.innerHTML += row; // добавляем новую строку в таблицу
            });
        })
        .catch(error => console.error('Ошибка:', error));
});
</script>
{% else %}
  {% include "includes/none_page.html" %}
{% endif %} 

{% endblock %} 